<UserControl x:Class="TemplateManager.MainView.MainView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:CommandModel="clr-namespace:TemplateManager.Common.CommandModel;assembly=TemplateManager.Common"
        xmlns:Regions="clr-namespace:Microsoft.Practices.Composite.Presentation.Regions;assembly=Microsoft.Practices.Composite.Presentation"
        xmlns:Infrastructure="clr-namespace:TemplateManager.Infrastructure;assembly=TemplateManager.Infrastructure"
	xmlns:ad="clr-namespace:AvalonDock;assembly=AvalonDock"
        x:Name="ThisControl">
    <UserControl.Resources>
        <DataTemplate x:Key="CustomTabHeader">
            <StackPanel Orientation="Horizontal">
                <ContentPresenter>
                    <ContentPresenter.Content>
                        <Binding Path="Content.Model.HeaderText">
                            <Binding.RelativeSource>
                                <RelativeSource Mode="FindAncestor" 
                                                AncestorType="{x:Type TabItem}"/>
                            </Binding.RelativeSource>
                        </Binding>
                    </ContentPresenter.Content>
                </ContentPresenter>
                <Button Margin="8,0,0,0" 
                        Command="{Binding Path=Model.CloseTabCommand.Command, ElementName=ThisControl}" 
                        CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type TabItem}}}" 
                        HorizontalContentAlignment="Center" 
                        VerticalContentAlignment="Center">
                    <Grid>
                        <Canvas Width="8" Height="8">
                            <Line X1="2" X2="6" Y1="2" Y2="6" Stroke="Black" StrokeThickness="1"/>
                            <Line X1="6" X2="2" Y1="2" Y2="6" Stroke="Black" StrokeThickness="1"/>
                        </Canvas>
                    </Grid>
                </Button>
            </StackPanel>
        </DataTemplate>

        <Style TargetType="TabItem">
            <Style.Setters>
                <Setter Property="HeaderTemplate" 
                        Value="{StaticResource CustomTabHeader}"/>
            </Style.Setters>
        </Style>
    </UserControl.Resources>
    <DockPanel>
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="E_xit" 
                          Command="{Binding CloseWindowCommand.Command}" 
                          CommandModel:CreateCommandBinding.Command="{Binding CloseWindowCommand}"
                          CommandParameter="{Binding ElementName=ThisControl}"/>
            </MenuItem>

            <MenuItem Header="_View">
                <MenuItem Header="_Templates"
                          Command="{Binding TemplatesViewCommand.Command}"
                          CommandModel:CreateCommandBinding.Command="{Binding TemplatesViewCommand}"
                          CommandParameter="{x:Static Infrastructure:RegionNames.DocumentRegion}"/>
                <MenuItem Header="_Duplicate Templates"
                          Command="{Binding DuplicateTemplatesViewCommand.Command}"
                          CommandModel:CreateCommandBinding.Command="{Binding DuplicateTemplatesViewCommand}"
                          CommandParameter="{x:Static Infrastructure:RegionNames.DocumentRegion}">
                    <MenuItem.Icon>
                        <Image Source="/Images/DuplicateTemplates.png" Width="16" Height="16" />
                    </MenuItem.Icon>
                </MenuItem>
                <Separator />
                <MenuItem Header="_Search"
                          Command="{Binding SearchViewCommand.Command}"
                          CommandModel:CreateCommandBinding.Command="{Binding SearchViewCommand}"
                          CommandParameter="{x:Static Infrastructure:RegionNames.SidePanelRegion}">
                    <MenuItem.Icon>
                        <Image Source="/Images/Search.png" Width="16" Height="16" />
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>

            <MenuItem Header="_Tools">
                <MenuItem Header="_Options" 
                          Command="{Binding ShowOptionsCommand.Command}"
                          CommandModel:CreateCommandBinding.Command="{Binding ShowOptionsCommand}">
                    <MenuItem.Icon>
                        <Image Source="/Images/Options.png" Width="16" Height="16" />
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>

            <MenuItem Header="_Help">
                <MenuItem Header="_Help Topics" 
                          Command="{Binding HelpTopics.Command}"
                          CommandModel:CreateCommandBinding.Command="{Binding HelpTopicsCommand}">
                    <MenuItem.Icon>
                        <Image Source="/Images/HelpTopics.png" Width="16" Height="16" />
                    </MenuItem.Icon>
                </MenuItem>

                <MenuItem Header="_About" 
                          Command="{Binding AboutCommand.Command}"
                          CommandModel:CreateCommandBinding.Command="{Binding AboutCommand}">
                    <MenuItem.Icon>
                        <Image Source="/Images/About.png" Width="16" Height="16" />
                    </MenuItem.Icon>
                </MenuItem>

                <MenuItem Header="Check for _Updates" 
                          Command="{Binding ShowUpdateCheckWindowCommand.Command}"
                          CommandModel:CreateCommandBinding.Command="{Binding ShowUpdateCheckWindowCommand}">
                </MenuItem>
            </MenuItem>
        </Menu>
        <Grid DockPanel.Dock="Bottom"
              CommandModel:CreateCommandBinding.Command="{Binding CloseTabCommand}" >
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <TabControl Regions:RegionManager.RegionName="{x:Static Infrastructure:RegionNames.DocumentRegion}" />

            <TabControl Regions:RegionManager.RegionName="{x:Static Infrastructure:RegionNames.SidePanelRegion}"
                        Grid.Column="1"/>
        </Grid>
    </DockPanel>
</UserControl>
